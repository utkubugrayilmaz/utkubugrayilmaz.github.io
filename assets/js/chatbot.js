function getSessionId(){let n=localStorage.getItem("utku_ai_session_id");return n||(n="sess_"+Math.random().toString(36).substr(2,9),localStorage.setItem("utku_ai_session_id",n)),n}function addMessage(n,e,t=!1){const o=document.getElementById("chat-messages"),i=document.createElement("div");i.className=`message ${e}`,t?i.innerHTML=n:i.innerText=n,o.appendChild(i)}const API_BASE_URL="https://utku-ai-bot.onrender.com",styles="\n    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');\n\n    /* Widget Konumu */\n    #utku-chat-widget {\n        position: fixed;\n        bottom: 25px;\n        right: 25px;\n        z-index: 99999;\n        font-family: 'JetBrains Mono', monospace; /* Modern Yaz\u0131l\u0131mc\u0131 Fontu */\n    }\n\n    /* A\xe7ma Butonu (Sitenin Mavisi ile Uyumlu) */\n    #chat-toggle-btn {\n        background: #2563eb; /* Sitedeki Mavi */\n        color: white;\n        border: none;\n        border-radius: 16px; /* Hafif K\xf6\u015feli (Yaz\u0131l\u0131mc\u0131 stili) */\n        width: 60px;\n        height: 60px;\n        cursor: pointer;\n        box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);\n        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-weight: bold;\n        font-size: 24px;\n    }\n    #chat-toggle-btn:hover { \n        transform: scale(1.1) rotate(-5deg);\n        background: #1d4ed8; \n    }\n\n    /* Ana Pencere */\n    #chat-container {\n        display: none;\n        width: 380px;\n        height: 600px;\n        max-height: 80vh;\n        background: #0f172a; /* Koyu Lacivert/Siyah (Modern Dark Mode) */\n        border-radius: 16px;\n        box-shadow: 0 20px 50px rgba(0,0,0,0.3);\n        flex-direction: column;\n        overflow: hidden;\n        position: absolute;\n        bottom: 80px;\n        right: 0;\n        border: 1px solid #334155;\n        animation: slideIn 0.3s ease-out;\n    }\n\n    /* Mobil Uyumluluk (Fix) */\n    @media (max-width: 480px) {\n        #chat-container {\n            position: fixed;\n            bottom: 0;\n            left: 0;\n            width: 100%;\n            height: 100dvh;\n            max-height: 100dvh;\n            border-radius: 0;\n            border: none;\n            z-index: 100000;\n        }\n        #utku-chat-widget {\n            bottom: 20px;\n            right: 20px;\n        }\n        #chat-input-area {\n            padding-bottom: env(safe-area-inset-bottom, 20px) !important;\n        }\n    }\n\n    @keyframes slideIn {\n        from { opacity: 0; transform: translateY(20px) scale(0.95); }\n        to { opacity: 1; transform: translateY(0) scale(1); }\n    }\n\n    /* Header */\n    #chat-header {\n        background: #1e293b;\n        color: white;\n        padding: 16px 20px;\n        font-size: 14px;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        border-bottom: 1px solid #334155;\n        letter-spacing: -0.5px;\n    }\n\n    /* Mesaj Alan\u0131 */\n    #chat-messages {\n        flex: 1;\n        padding: 20px;\n        overflow-y: auto;\n        background: #0f172a;\n        display: flex;\n        flex-direction: column;\n        gap: 16px;\n    }\n\n    /* Mesaj Balonlar\u0131 */\n    .message {\n        max-width: 88%;\n        padding: 12px 16px;\n        font-size: 13px;\n        line-height: 1.6;\n        position: relative;\n        word-wrap: break-word;\n        border-radius: 12px;\n    }\n    \n    /* Bot Mesaj\u0131 */\n    .bot-msg {\n        background: #1e293b;\n        color: #e2e8f0;\n        align-self: flex-start;\n        border-bottom-left-radius: 2px;\n        border: 1px solid #334155;\n    }\n    .bot-msg::before {\n        content: \"AI\";\n        font-size: 10px;\n        color: #94a3b8;\n        display: block;\n        margin-bottom: 4px;\n        font-weight: bold;\n    }\n\n    /* Kullan\u0131c\u0131 Mesaj\u0131 */\n    .user-msg {\n        background: #2563eb;\n        color: white;\n        align-self: flex-end;\n        border-bottom-right-radius: 2px;\n        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);\n    }\n\n    /* Input Alan\u0131 */\n    #chat-input-area {\n        padding: 16px;\n        background: #1e293b;\n        border-top: 1px solid #334155;\n        display: flex;\n        gap: 12px;\n        align-items: center;\n    }\n    \n    #chat-input {\n        flex: 1;\n        padding: 12px;\n        background: #0f172a;\n        border: 1px solid #334155;\n        border-radius: 8px;\n        color: white;\n        font-family: 'JetBrains Mono', monospace;\n        font-size: 13px;\n        outline: none;\n        transition: border 0.2s;\n    }\n    #chat-input:focus { border-color: #2563eb; }\n    \n    #send-btn {\n        background: #2563eb;\n        color: white;\n        border: none;\n        border-radius: 8px;\n        padding: 10px 16px;\n        cursor: pointer;\n        font-weight: bold;\n        font-family: 'JetBrains Mono', monospace;\n        transition: background 0.2s;\n    }\n    #send-btn:hover { background: #1d4ed8; }\n    #send-btn:disabled { background: #475569; cursor: not-allowed; }\n    \n    .typing-indicator {\n        font-size: 11px;\n        color: #94a3b8;\n        margin-left: 20px;\n        margin-bottom: 10px;\n        display: none;\n    }\n    .typing-indicator::after {\n        content: '...';\n        animation: blink 1.5s infinite;\n    }\n    @keyframes blink { 0% { opacity: .2; } 20% { opacity: 1; } 100% { opacity: .2; } }\n",html='\n    <div id="utku-chat-widget">\n        <div id="chat-container">\n            <div id="chat-header">\n                <div style="display:flex; align-items:center; gap:10px;">\n                    <div style="width:10px; height:10px; background:#22c55e; border-radius:50%;"></div>\n                    <div>\n                        <div style="font-weight:700;">Utku AI Asistan\u0131</div>\n                        <div style="font-size:11px; opacity:0.7;">v1.0 \u2022 Online</div>\n                    </div>\n                </div>\n                <span style="cursor:pointer; padding:5px;" onclick="toggleChat()">\u2715</span>\n            </div>\n            <div id="chat-messages">\n                <div class="message bot-msg">\n                    Merhaba! Ben Utku\'nun dijital ikiziyim. \ud83e\udd16<br>Projelerim, kodlar\u0131m veya tecr\xfcbelerim hakk\u0131nda her \u015feyi sorabilirsin.\n                </div>\n            </div>\n            <div class="typing-indicator" id="typing">d\xfc\u015f\xfcn\xfcyor</div>\n            <div id="chat-input-area">\n                <input type="text" id="chat-input" placeholder="Komut girin..." onkeypress="handleKeyPress(event)">\n                <button id="send-btn" onclick="sendMessage()">G\xd6NDER</button>\n            </div>\n        </div>\n        <button id="chat-toggle-btn" onclick="toggleChat()">\n            <span>>_</span>\n        </button>\n    </div>\n';!function(){const n=document.createElement("style");n.innerText=styles,document.head.appendChild(n);const e=document.createElement("div");e.innerHTML=html,document.body.appendChild(e)}(),window.toggleChat=function(){const n=document.getElementById("chat-container"),e="flex"===n.style.display;n.style.display=e?"none":"flex",!e&&window.innerWidth>480&&document.getElementById("chat-input").focus()},window.handleKeyPress=function(n){"Enter"===n.key&&sendMessage()},window.sendMessage=async function(){const n=document.getElementById("chat-input"),e=document.getElementById("chat-messages"),t=document.getElementById("send-btn"),o=document.getElementById("typing"),i=n.value.trim();if(i){addMessage(i,"user-msg"),n.value="",t.disabled=!0,o.style.display="block",e.scrollTop=e.scrollHeight;try{const n=await fetch(`${API_BASE_URL}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:i,session_id:getSessionId()})}),e=await n.json();if(e.reply){addMessage(e.reply.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>").replace(/\* (.*?)\n/g,"\u2022 $1<br>").replace(/\n/g,"<br>"),"bot-msg",!0)}else e.error?addMessage("\u26a0\ufe0f "+e.error,"bot-msg"):addMessage("Bir ba\u011flant\u0131 hatas\u0131 olu\u015ftu.","bot-msg")}catch(n){addMessage("Sunucuya ula\u015f\u0131lam\u0131yor.","bot-msg")}finally{t.disabled=!1,o.style.display="none",e.scrollTop=e.scrollHeight}}};